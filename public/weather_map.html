<!DOCTYPE html>
<html>
<head>
    <title>My Weather Map</title>
    <link rel="stylesheet" href="/css/css_weather.css">
</head>
<body>
<h1>3-day Forecast Map</h1>
    <button id="button1">Check Weather</button>
    <div id="map-canvas"></div>
    <div id="weather_info"></div>
    <div id="forecast_back"></div>
    <div id="long_lat">
        <div>
            <input id="lat" type="text" value="29.423017"/>
            <input id="long" type="text" value="-98.48527"/>
        </div>
    </div>


<!-- Load the Google Maps API [DON'T FORGET TO USE A KEY] -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzYwhzfsae_5Cs8rH4tbtyYpxWVFhEajA"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
(function(){
    "use strict"

        var geocoder;
        var map;
        var myLatlng = new google.maps.LatLng($("#lat").val(), $("#long").val());
        var mapOptions = {
             zoom: 5,
            center: myLatlng
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
        var marker = new google.maps.Marker({
            position: myLatlng,
            map: map,
            draggable:true,
        });
        marker.setMap(map);
        google.maps.event.addListener(marker, 'dragend', function (event) {
        document.getElementById("lat").value = this.getPosition().lat();
        document.getElementById("long").value = this.getPosition().lng();
        });

// THIS IS THE BUTTTON FOR LAT AND LONG

    $("#button1").click(function () {
        var $longitude = $("#long").val();
        var $latitude = $("#lat").val()
        var coordinates = "http://api.openweathermap.org/data/2.5/forecast?lat=" + $("#lat").val() + "&lon=" + $("#long").val(); 
        var info = '';
        map.setCenter(marker.position);
        var weather = $.get(coordinates, {
            APPID: "988a5fd222f83e03ba0fbb954a54524a",
            units: "imperial"

        })


        weather.done(function(data){
            $(data).each(function(i, temps){
                info += '<div>';
                info += '<h2 id="cityName">' + temps.city.name + ', ' + temps.city.country + '</h2>';
                info += '</div>';
                info += '<div id="day_1">';
                info += '<p id="main_temps">' + temps.list[0].main.temp_max + 'F/' + temps.list[0].main.temp_min + 'F'+'</p>';
                info += '<p>' + '<strong>Weather: </strong>' + temps.list[0].weather[0].description + '</p>';
                info += '<p>' + '<img src="http://openweathermap.org/img/w/' + temps.list[0].weather[0].icon + '.png" />'+'</p>';
                info += '<p>' + 'Humidity: ' + temps.list[0].main.humidity + '</p>';
                info += '<p>' + 'Speed: ' + temps.list[0].wind.speed + '</p>';
                info += '<p>' + 'Pressure: ' + temps.list[0].main.pressure + '</p>';
                info += '</div>';

                info += '<div id="day_2">';
                info += '<p id="main_temps">' + temps.list[8].main.temp_max + 'F/' + temps.list[8].main.temp_min + 'F'+'</p>';
                info += '<p>' + '<strong>Weather: </strong>' + temps.list[8].weather[0].description + '</p>';
                info += '<p>' + '<img src="http://openweathermap.org/img/w/' + temps.list[8].weather[0].icon + '.png" />'+'</p>';
                info += '<p>' + 'Humidity: ' + temps.list[8].main.humidity + '</p>';
                info += '<p>' + 'Speed: ' + temps.list[8].wind.speed + '</p>';
                info += '<p>' + 'Pressure: ' + temps.list[8].main.pressure + '</p>';
                info += '</div>';


                info += '<div id="day_3">';
                info += '<p id="main_temps">' + temps.list[16].main.temp_max + 'F/' + temps.list[16].main.temp_min + 'F'+'</p>';
                info += '<p>' + '<strong>Weather: </strong>' + temps.list[16].weather[0].description + '</p>';
                info += '<p>' + '<img src="http://openweathermap.org/img/w/' + temps.list[16].weather[0].icon + '.png" />'+'</p>';
                info += '<p>' + 'Humidity: ' + temps.list[16].main.humidity + '</p>';
                info += '<p>' + 'Speed: ' + temps.list[16].wind.speed + '</p>';
                info += '<p>' + 'Pressure: ' + temps.list[16].main.pressure + '</p>';
                info += '</div>';
                console.log(data);
            })
            $('#weather_info').html(info);
        });

});
})();

</script>
</body>
</html>